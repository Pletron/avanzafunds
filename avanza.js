var urllist = ["https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=1&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=2&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=3&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=4&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=5&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=6&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=7&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=8&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=9&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=10&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=11&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=12&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=13&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=14&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=15&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=16&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=17&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=18&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=19&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=20&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=21&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=22&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=23&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=24&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=25&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=26&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=27&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=28&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=29&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=30&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=31&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=32&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=33&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=34&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=35&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=36&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=37&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=38&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=39&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=40&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=41&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=42&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=43&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=44&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=overview"];
var urllisthistory = ["https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=1&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=2&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=3&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=4&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=5&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=6&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=7&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=8&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=9&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=10&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=11&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=12&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=13&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=14&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=15&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=16&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=17&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=18&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=19&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=20&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=21&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=22&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=23&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=24&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=25&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=26&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=27&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=28&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=29&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=30&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=31&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=32&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=33&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=34&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=35&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=36&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=37&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=38&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=39&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=40&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=41&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=42&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=43&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history", "https://www.avanza.se/fonder/lista.html?disableSelection=false&name=&page=44&sortField=CHANGE_IN_SEK_SINCE_THREE_MONTHS&sortOrder=DESCENDING&activeTab=history"];
var request = require('sync-request'),
    cheerio = require('cheerio'),
    json2csv = require('json2csv'),
    tabletojson = require('tabletojson'),
    fs = require('fs');

var searchTerm = 'screen+scraping';
var url = 'http://www.bing.com/search?q=' + searchTerm;


var funds = [];


for (var i = 0; i < urllist.length; i++) {

    var fundsLength = funds.length;

    var res = request('GET', urllist[i]);
    $ = cheerio.load(res.getBody());
    table = $('#contentTable tbody'); //use your CSS selector here

    table.find('tr').each(function(ia, ela) {
        var fund = {
            Name: '',
            ListFee: '',
            ListRating: '',
            ListRisk: '',

            ListLastYear: '',
            List1WeekHistory: '',
            List1MonthHistory: '',
            List3MonthsHistory: '',
            List6MonthsHistory: '',
            List1Year: '',
            List3Years: '',
            List5Years: ''
        };
        fund.Name = $(ela).find('.fundListName a').attr('title').trim();
        fund.ListFee = parseFloat($(ela).find('.fundListFee').text().trim()) * 0.01;
        fund.ListRating = $(ela).find('.fundListRating').text().trim();

        try {
			fund.ListRisk = $(ela).find('.fundListRisk').text().trim().split('(')[1].charAt(0);
        } catch(e) {
			fund.ListRisk = $(ela).find('.fundListRisk').text().trim();
        }

        funds.push(fund);
    });

    var res = request('GET', urllisthistory[i]);
    $ = cheerio.load(res.getBody());
    table = $('#contentTable tbody'); //use your CSS selector here

    table.find('tr').each(function(ia, ela) {
        funds[fundsLength + ia].ListLastYear = parseFloat($(ela).find('.fundListLastYear').text().trim()) * 0.01;
        funds[fundsLength + ia].List1WeekHistory = parseFloat($(ela).find('.fundList1WeekHistory').text().trim()) * 0.01;
        funds[fundsLength + ia].List1MonthHistory = parseFloat($(ela).find('.fundList1MonthHistory').text().trim()) * 0.01;
        funds[fundsLength + ia].List3MonthsHistory = parseFloat($(ela).find('.fundList3MonthsHistory').text().trim()) * 0.01;
        funds[fundsLength + ia].List6MonthsHistory = parseFloat($(ela).find('.fundList6MonthsHistory').text().trim()) * 0.01;
        funds[fundsLength + ia].List1Year = parseFloat($(ela).find('.fundList1Year').text().trim()) * 0.01;
        funds[fundsLength + ia].List3Years = parseFloat($(ela).find('.fundList3Years').text().trim()) * 0.01;
        funds[fundsLength + ia].List5Years = parseFloat($(ela).find('.fundList5Years').text().trim()) * 0.01;
    });

    console.log('Parsed page: ' + (i + 1) + ' of ' + urllist.length + '. Funds parsed: ' + funds.length);
}

json2csv({
    data: funds,
    del: ';',
    fields: ['Name', 'ListFee', 'ListRating', 'ListRisk', 'ListLastYear', 'List1WeekHistory', 'List1MonthHistory', 'List3MonthsHistory', 'List6MonthsHistory', 'List1Year', 'List3Years', 'List5Years']
}, function(err, csv) {
    if (err) console.log(err);
    fs.writeFile('avanzaFunds.csv', csv, function(err) {
        if (err) throw err;
        console.log('file saved');
    });
});




